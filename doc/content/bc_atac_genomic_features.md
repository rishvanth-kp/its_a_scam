# bc_atac_genomic_features

`bc_atac_genomic_features` is used to determine the fraction reads
aligned to different genomic regions at the single cell level. In an
typical ATAC-seq experiment, we would expect a lot reads to aligning to
the the open chromatin regions that are mostly located in TSS and gene
body regions. This program determines the number of reads and the mean
fragment length of reads aligned to distinct genomic regions. 


## Description

## Parameters
```
bc_atac_genomic_features [options]
	-a aligned SAM/BAM file [required]
	-b barcode list file [required]
	-g gtf file [required]
	-r tsr bed file [optional]
	-e enhancers bed file [optional]
	-o out file prefix [required]
	-m min fragment length [default: 0]
	-M max fragment length [default: inf]
	-d name split delimeter [default: ":"; ignored if -t is provided]
	-c barcode field in name [default: 7 (0 based); ignored if -t is provided]
	-t barcode tag in SAM/BAM file [default ""]
	-q minimum mapping quality to include [default: 0]
	-f only include if all the flags are present [default: 3]
	-F only include if none of the flags are present [default: 3340]
	-v verbose [default: false]
```

`-a`: The input aligned paired end SAM or BAM file. The cell barcode
should be present either in a SAM tag or encoded in the query name
(QNAME) field, see options `\t`, `-d`, and `-c`. [Required].

`-b`: Only the SAM/BAM entries that match a barcode in this file are
processed. [Required].

`-g`: GTF file that is used to parse the gene regions. [Required].

`-r`: A bed-3 file with transcription start regions. If this bed file is
provided the fraction of reads in the TSR regions are computed. [Optional].

`-e` A bed-3 file with enhancer regions. If this bed file is provided
the fraction of reads in the enhancer regions are computed [Optional].

`-o`: Output file prefix. [Default = ""].

`-m`: Minimum fragment length to include. Alignments that have a
fragment length (insert size) lower than this value are ignored.
[Default: 0].

`-M`: Maximum fragment length to include. Alignments that have a
fragment length (insert size) higher than this value are ignored.
[Default: 1024].

`-d`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the specified delimiter. [Default:
":"]. 

`-c`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the delimiter specified by `-d`
and take the barcode as the value in the columns specified by `-c` (0
based). For example, reads that are generated by Illumina sequencers
have a FASTQ names that have 7 fields that are separated by a ":", and
the cell barcode is typically added as the 8th field. [Default: 7].   

`-t`: Used when the cell barcode is present in a SAM entry as a tag. For
example, SAM files generated by CellRanger encodes the error correct
cell barcode in the `CB` tag. If this parameter is set, `-d` and `-c`
flags are ignored. [Default: none]

`-q`: Include only fragments for which both reads have a mapping
quality greater than or equal to the specified value. [Default: 0]

`-f`: Include only fragments for which both reads have all of the
specified flags present. For example, to include paired reads (0x1 or
0b1) and reads that are mapped in proper pair (0x2 or 0b2), specify the
sum of of these flags (1 + 2 = 3). [Default: 3]. 

`-F`: Include only fragments for which both reads have none of the
specified frags present. For example, to exclude PCR duplicates (0x400
or 0b1024) and supplementary alignments (0x800 or 0b2048), specify the
sum of these flags (1024 + 2048 = 3072). [default: 3340].

`-v`: Verbosity flag. Set the flag to print progress and statistics to
standard error. [Default: false].

## Input and output file description
### Description of input files
1. A paired-end aligned SAM/BAM file that has a cell barcode encoded
in the query name.
1. A TSV file with the cell barcodes in the first column. The counts are
determined only for these barcodes. 
1. A GTF file with the genomic regions of interest. The GTF file
downloaded from [Gencode](https://www.gencodegenes.org/) can be used
directly.  
1. Optional 3-column bed files with transcription start
regions or enhancer regions (if the bed file contains more then 3
columns, they are ignored).

### Description of output files
1. `<output_prefix>_feature_counts.txt`: This file contains one row per
cell. The first column contains the cell barcode, the second column
contains the total count over all regions (that can be used for
normalizing the counts for each cell), and the subsequent
columns are the genomic regions. The contain the number of reads aligned
the a regions. This file has the header line describing the genomic
regions.  
1. `<output_prefix>_feature_frag_len.txt`:  Identical to the above file,
but contains the mean fragment length of all the fragments that are
aligned to specific genomic regions. 
1. `<output_prefix>_feature_align_len.txt`: Identical to the above file,
but contains the number of bases in the paired-end fragment that are
aligned to specific genomic regions. 


