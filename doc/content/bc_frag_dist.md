# bc_frag_dist

## Description
Compute the cell-level and sample-level fragment length distribution.

## Parameters
```
bc_frag_dist [options]
	-a aligned SAM/BAM file [required]
	-b barcode list file [required]
	-o out file prefix [required]
	-m max fragment length to track [default: 600]
	-d name split delimeter [default: ":"]
	-c barcode field in name [default: 7 (0 based)]
	-q minimum mapping quality to include [default: 0]
	-f only include if all the flags are present [default: 3]
	-F only include if none of the flags are present [default: 3340]
	-v verbose [default: false]
```

`-a`: The input aligned paired end SAM or BAM file. The cell barcode
should be present either in a SAM tag or encoded in the query name
(QNAME) field, see options `\t`, `-d`, and `-c`. [Required].

`-b`: If a barcode list file is provided, only the SAM/BAM entries that
match a barcode are processed. [Required].

`-o`: Output file prefix. [Default = ""].

`-m`: Maximum fragment length to keep track of. All fragments that are
longer are ignored. [Default: 600].

`-d`: Split the QNAME by the specified delimiter to retrieve the cell
barcode. [Default: ":"]. 

`-c`: Split the QNAME by the delimiter specified by `-d`
and take the barcode as the value in the columns specified by `-c` (0
based). For example, reads that are generated by Illumina sequencers
have a FASTQ names that have 7 fields that are separated by a ":", and
the cell barcode is typically added as the 8th field. [Default: 7].   

`-q`: Include only fragments for which both reads have a mapping
quality greater than or equal to the specified value. [Default: 0]

`-f`: Include only fragments for which both reads have all of the
specified flags present. For example, to include paired reads (0x1 or
0b1) and reads that are mapped in proper pair (0x2 or 0b2), specify the
sum of of these flags (1 + 2 = 3). [Default: 3]. 

`-F`: Include only fragments for which both reads have none of the
specified frags present. For example, to exclude PCR duplicates (0x400
or 0b1024) and supplementary alignments (0x800 or 0b2048), specify the
sum of these flags (1024 + 2048 = 3072). [default: 3340].

`-v`: Verbosity flag. Set the flag to print progress and statistics to
standard error. [Default: false].

## Input and output file description
### Description of input files
1. An aligned SAM/BAM file that has a cell barcode encoded
either in the query name or in a tag.  
2. A TSV file with the cell barcode in the first column. The fragment
length distribution are computed only for the these barcodes.

### Description of output files
The fragment length distribution is computed at both the cell level and
the sample level.
 
1. `<output_prefix_bc_frag_len.txt>`: Cell level fragment length
distribution matrix. The rows of the matrix are the cells and the columns
of the are fragment lengths. Each row contains the fragment length
distribution of a cell. The distribution is normalized by the total
number of fragments per cell. This file contains a header
line. 
2. `<output_prefix_sample_frag_len.txt>`: Sample level fragment length
distribution. The bulk fragment length distribution of all cells (that are
included in the cell barcode TSV file). This is a 3 column TSV file
(with the header). The first column contains the fragment length, the
second contains the fragment count at that length, and the third
column contains the normalized fragment count. 
