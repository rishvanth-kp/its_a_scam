# bc_count_matrix 

## Description

Generate a cell-region count matrix.  

## Parameters
```
bc_count_matrix [options]
  -a aligned SAM/BAM file [required]
  -b barcode list file [required]
  -t region bed file [required]
  -s distance to add to either side of each region [default: 0]
  -o out file prefix [required]
  -m min. fragment length [default: 0]
  -M max. fragment length [default: 1024]
  -d name split delimeter [default: ":"]
  -c barcode field in name [default: 7 (0 based)]
  -q minimum mapping quality to include [default: 0]
  -f only include if all the flags are present [default: 3]
  -F only include if none of the flags are present [default: 3340]
  -v verbose [default: false]

```

`-a`: The input aligned paired end SAM or BAM file. The cell barcode
should be encoded in the query name (QNAME) field, see options `-d` and
`-c`. [Required].

`-b`: Only the SAM/BAM entries that match a barcode in this file are
processed. [Required].

`-t` A bed file with the regions of interest. A fourth column is
expected that contains a unique name for each region. [Required].

`-s` Number of bases to add to the  ends of each region in the above bed
file. This parameter is useful to include the alignments flanking a
region of interest. For example if the bed file contains transcription
start sites, specifying `-s` as 1000 would also count the number of
alignment that fall within a 1000 bp window flanking the site. [Default:
0].

`-o`: Output file prefix. [Default = ""].

`-m`: Minimum fragment length to include. Alignments that have a
fragment length (insert size) lower than this value are ignored.
[Default: 0].

`-M`: Maximum fragment length to include. Alignments that have a
fragment length (insert size) higher than this value are ignored.
[Default: 1024].

`-d`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the specified delimiter. [Default:
":"]. 

`-c`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the delimiter specified by `-d`
and take the barcode as the value in the columns specified by `-c` (0
based). For example, reads that are generated by Illumina sequencers
have a FASTQ names that have 7 fields that are separated by a ":", and
the cell barcode is typically added as the 8th field. [Default: 7].   

`-q`: Include only fragments for which both reads have a mapping
quality greater than or equal to the specified value. [Default: 0]

`-f`: Include only fragments for which both reads have all of the
specified flags present. For example, to include paired reads (0x1 or
0b1) and reads that are mapped in proper pair (0x2 or 0b2), specify the
sum of of these flags (1 + 2 = 3). [Default: 3]. 

`-F`: Include only fragments for which both reads have none of the
specified frags present. For example, to exclude PCR duplicates (0x400
or 0b1024) and supplementary alignments (0x800 or 0b2048), specify the
sum of these flags (1024 + 2048 = 3072). [default: 3340].

`-v`: Verbosity flag. Set the flag to print progress and statistics to
standard error. [Default: false].

## Input and output file description
### Description of input files
1. A paired-end aligned SAM/BAM file that has a cell barcode encoded
in the query name.
2. A bed file that contains the regions of interest. A 4th column
is expected to contain a name for the region. 
3. A TSV file with the cell barcodes in the first column. The counts are
determined only for these barcodes. 

### Description of output files
1. `<output_prefix>_region_counts.txt` file containing the count matrix.
The rows of the file are the regions and the columns are the cells.  The
first 4 columns contain the the chrom name, start, end, and region name.
The cells start from the 5th columns. This file has a header line that
has the cell barcodes. 
