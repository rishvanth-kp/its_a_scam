# bc_flagstat

## Description
`samtools flagstat` is extremely useful to get alignment statistics
such as the number of aligned reads, number of PCR duplicates, etc. from
a sam/bam file. `bc_flagstat` is used to give almost the same information as
`flagstat` at a single cell level

## Parameters
```
bc_flagstat [options]
  -a aligned SAM/BAM file [required]
  -b barcode list [required]
  -o outfile prefix [required]
  -d name split delimeter [default: ":"; ignored if -t is provided]
  -c barcode field in name [default: 7 (0 based); ignored if -t is provided]
  -t barcode tag in SAM file [default: ""]
  -q minimum mapping quality to include [default: 0]
  -v verbose [default: false]
```

`-a`: The input aligned paired end SAM or BAM file. The cell barcode
should be present either in a SAM tag or encoded in the query name
(QNAME) field, see options `\t`, `-d`, and `-c`. [Required].

`-b`: A list of barcodes to retain in the output file. [Required].

`-o`: Output file name. [Required].

`-d`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the specified delimiter. [Default:
":"]. 

`-c`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the delimiter specified by `-d`
and take the barcode as the value in the columns specified by `-c` (0
based). For example, reads that are generated by Illumina sequencers
have a FASTQ names that have 7 fields that are separated by a ":", and
the cell barcode is typically added as the 8th field. [Default: 7].   

`-t`: Used when the cell barcode is present in a SAM entry as a tag. For
example, SAM files generated by CellRanger encodes the error correct
cell barcode in the `CB` tag. If this parameter is set, `-d` and `-c`
flags are ignored. [Default: none]

`-q`: Include only fragments for which both reads have a mapping
quality greater than or equal to the specified value. [Default: 0]

`-v`: Verbosity flag. Set the flag to print progress and statistics to
standard error. [Default: false].

## Input and output file description
### Description of input files
1. An aligned SAM/BAM file that has a cell barcode encoded
either in the query name or in a tag.  
2. A TSV file with the cell barcode in the first column. Only the
alignments containing barcodes in the file are retained in the output
SAM file.  

### Description of output files
`<output_prefix>_bc_flagstat.txt`: A file containing the single cells
flagstats. Each row of the file corresponds to a cells. The first
columns contains the cell barcode, and the flagstats start from the
second column. The following counts are computed for each cell: primary,
secondary, supplementary, duplicates, primary_duplicates,
mapped, primary_mapped, paired_in_sequencing, read_1, read_2,
properly_paired, with_itself_and_mate_mapped, and singletons. The
definitions of these are identical to `samtools flagstat` as defined
[here](https://www.htslib.org/doc/samtools-flagstat.html). This file
contains a header line.
