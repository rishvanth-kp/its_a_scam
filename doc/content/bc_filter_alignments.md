# bc_filter_alignments

## Description
An aligned SAM/BAM file contains reads from all cell barcodes. However,
most cell barcodes would contain too few reads than useful downstream
analysis. This program is used to retain alignments that belong to a set
of desired cell barcodes. 

## Parameters
```
bc_filter_alignments [options]
	-a aligned SAM/BAM file [required]
	-b barcode list file [required]
	-o out file name [required]
	-d name split delimeter[default: ":"]; ignored if -t is provided
	-c barcode field in name[default: 7 (0 based); ignored if -t is provided]
	-t barcode tag in SAM file [default ""]
	-q minimum mapping quality to include [default: 0]
	-f only include if all the flags are present [default: 3]
	-F only include if none of the flags are present [default: 3340]
	-v verbose [default: false]
```

## Input and output file description
`-a`: The input aligned paired end SAM or BAM file. The cell barcode
should be present either in a SAM tag or encoded in the query name
(QNAME) field, see options `\t`, `-d`, and `-c`. [Required].

`-b`: A list of barcodes to retain in the output file. [Required].

`-o`: Output file name. [Required].

`-d`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the specified delimiter. [Default:
":"]. 

`-c`: Used when the cell barcode is encoded as a part of the query name
(QNAME field). Split the QNAME by the delimiter specified by `-d`
and take the barcode as the value in the columns specified by `-c` (0
based). For example, reads that are generated by Illumina sequencers
have a FASTQ names that have 7 fields that are separated by a ":", and
the cell barcode is typically added as the 8th field. [Default: 7].   

`-t`: Used when the cell barcode is present in a SAM entry as a tag. For
example, SAM files generated by CellRanger encodes the error correct
cell barcode in the `CB` tag. If this parameter is set, `-d` and `-c`
flags are ignored. [Default: none]

`-q`: Include only fragments for which both reads have a mapping
quality greater than or equal to the specified value. [Default: 0]

`-f`: Include only fragments for which both reads have all of the
specified flags present. For example, to include paired reads (0x1 or
0b1) and reads that are mapped in proper pair (0x2 or 0b2), specify the
sum of of these flags (1 + 2 = 3). [Default: 3]. 

`-F`: Include only fragments for which both reads have none of the
specified frags present. For example, to exclude PCR duplicates (0x400
or 0b1024) and supplementary alignments (0x800 or 0b2048), specify the
sum of these flags (1024 + 2048 = 3072). [default: 3340].

`-v`: Verbosity flag. Set the flag to print progress and statistics to
standard error. [Default: false].

## Input and output file description
### Description of input files
1. An aligned SAM/BAM file that has a cell barcode encoded
either in the query name or in a tag.  
2. A TSV file with the cell barcode in the first column. Only the
alignments containing barcodes in the file are retained in the output
SAM file.  

### Description of output files
A SAM file that with just the alignments with cell barcodes contained
the provided barcode list. Of note, the output is always in SAM format
at the moment, and will be upgraded to generate either SAM or BAM files in
the future.   
